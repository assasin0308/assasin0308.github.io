<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>配置Node.js环境 | assasin&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="[TOC] 新项目需要使用node.js。 记录一下node.js和npm安装过程. 1. Mac本地安装Node.js下载之前的node.js项目, 用phpstorm打开后报语法错误. 检查phpstorm的nodejs插件已启用. 判断是node.js环境未配置.  Mac安装配置node.js和npm. 访问node.js官网下载列表(https:&#x2F;&#x2F;nodejs.org&#x2F;en&#x2F;downl">
<meta property="og:type" content="article">
<meta property="og:title" content="配置Node.js环境">
<meta property="og:url" content="http://yoursite.com/2020/07/03/%E9%85%8D%E7%BD%AENode-js%E7%8E%AF%E5%A2%83/index.html">
<meta property="og:site_name" content="assasin&#39;s Blog">
<meta property="og:description" content="[TOC] 新项目需要使用node.js。 记录一下node.js和npm安装过程. 1. Mac本地安装Node.js下载之前的node.js项目, 用phpstorm打开后报语法错误. 检查phpstorm的nodejs插件已启用. 判断是node.js环境未配置.  Mac安装配置node.js和npm. 访问node.js官网下载列表(https:&#x2F;&#x2F;nodejs.org&#x2F;en&#x2F;downl">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-03T09:44:59.000Z">
<meta property="article:modified_time" content="2020-07-03T09:47:44.346Z">
<meta property="article:author" content="assasin">
<meta property="article:tag" content="PHP linux Python Javascript Html">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="assasin&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">assasin&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">不要迷恋哥,哥只是个传说</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-配置Node-js环境" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/03/%E9%85%8D%E7%BD%AENode-js%E7%8E%AF%E5%A2%83/" class="article-date">
  <time datetime="2020-07-03T09:44:59.000Z" itemprop="datePublished">2020-07-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      配置Node.js环境
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>[TOC]</p>
<p>新项目需要使用node.js。 记录一下node.js和npm安装过程.</p>
<h3 id="1-Mac本地安装Node-js"><a href="#1-Mac本地安装Node-js" class="headerlink" title="1. Mac本地安装Node.js"></a>1. Mac本地安装Node.js</h3><pre><code>下载之前的node.js项目, 用phpstorm打开后报语法错误. 检查phpstorm的nodejs插件已启用. 判断是node.js环境未配置.

Mac安装配置node.js和npm.</code></pre><ol>
<li><p>访问node.js官网下载列表(<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a>)</p>
<p>下载推荐的node-v8.11.3.pkg包, 点击并根据提示进行安装.  安装完成后会显示软件的安装版本和安装位置, 如下所示.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	•	Node.js v8.11.3 to /usr/local/bin/node</span><br><span class="line">	•	npm v5.6.0 to /usr/local/bin/npm</span><br><span class="line">Make sure that /usr/local/bin is in your $PATH.</span><br></pre></td></tr></table></figure>

<p>可在控制台输入以下命令查看安装版本.</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v8<span class="selector-class">.11</span><span class="selector-class">.3</span></span><br><span class="line">$ npm -v</span><br><span class="line">5<span class="selector-class">.6</span><span class="selector-class">.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>更换为淘宝的NPM镜像(<a href="http://npm.taobao.org" target="_blank" rel="noopener">http://npm.taobao.org</a>)</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查看当前镜像</span></span><br><span class="line">$ npm get registry</span><br><span class="line">https://registry.npmjs.org/</span><br><span class="line">//更换为淘宝的镜像 -- 此方案安装cnpm, 不影响之前的npm</span><br><span class="line">sudo npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">//添加成功后查看cnpm版本信息</span><br><span class="line">$ cnpm -v</span><br><span class="line">cnpm@<span class="number">6.0</span>.<span class="number">0</span> (/usr/local/lib/node_modules/cnpm/lib/parse_argv.js)</span><br><span class="line">npm@<span class="number">6.2</span>.<span class="number">0</span> (/usr/local/lib/node_modules/cnpm/node_modules/npm/lib/npm.js)</span><br><span class="line">node@<span class="number">8.11</span>.<span class="number">3</span> (/usr/local/bin/node)</span><br><span class="line">npminstall@<span class="number">3.10</span>.<span class="number">0</span> (/usr/local/lib/node_modules/cnpm/node_modules/npminstall/lib/index.js)</span><br><span class="line">prefix=/usr/local </span><br><span class="line">darwin x64 <span class="number">17.4</span>.<span class="number">0</span> </span><br><span class="line">registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入express框架及其相关模块</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装express并将其保存到依赖列表中</span></span><br><span class="line">cnpm install express --save</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看已安装过的包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;全局查看</span><br><span class="line">npm list -g --depth 0</span><br><span class="line">&#x2F;&#x2F;查看本地</span><br><span class="line">npm list --depth 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>卸载本地package</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall &lt;package-name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建package.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用 npm init 即可在当前目录创建一个 package.json 文件：</span><br></pre></td></tr></table></figure>

<p>输入 <code>npm init</code> 后会弹出一堆问题，我们可以输入对应内容，也可以使用默认值。在回答一堆问题后输入 <code>yes</code> 就会生成图中所示内容的  <code>package.json</code> 文件。</p>
<p>如果嫌回答这一大堆问题麻烦，可以直接输入 <code>npm init --yes</code> 跳过回答问题步骤，直接生成默认值的 <code>package.json</code> 文件：</p>
</li>
</ol>
<h3 id="2-centos6-5-nvm-安装升级nodejs"><a href="#2-centos6-5-nvm-安装升级nodejs" class="headerlink" title="2. centos6.5 nvm 安装升级nodejs"></a>2. centos6.5 nvm 安装升级nodejs</h3><ol>
<li><p>查看服务器nodejs版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># node -v</span><br><span class="line">v6.10.3</span><br><span class="line"># npm -v</span><br><span class="line">3.10.10</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务器以前版本是通过nvm安装管理的</p>
<p>通过nvm安装升级指定nodejs</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查看可用node版本</span></span><br><span class="line"># nvm ls-remote</span><br><span class="line">  	 v8<span class="selector-class">.11</span><span class="selector-class">.1</span></span><br><span class="line">     v8<span class="selector-class">.11</span><span class="selector-class">.2</span></span><br><span class="line">-&gt;   v8<span class="selector-class">.11</span><span class="selector-class">.3</span></span><br><span class="line">     v9<span class="selector-class">.0</span><span class="selector-class">.0</span></span><br><span class="line">     </span><br><span class="line"><span class="comment">//安装v8.11.3版本</span></span><br><span class="line">nvm install v8<span class="selector-class">.11</span><span class="selector-class">.3</span></span><br><span class="line"><span class="comment">//安装完成后使用新版</span></span><br><span class="line">nvm use v8<span class="selector-class">.11</span><span class="selector-class">.3</span></span><br><span class="line"><span class="comment">//卸载旧版本(只有在该版本未使用状态可卸载)</span></span><br><span class="line">nvm uninstall v6<span class="selector-class">.10</span><span class="selector-class">.3</span></span><br><span class="line"><span class="comment">//将此版本设为默认</span></span><br><span class="line">nvm alias default v6<span class="selector-class">.10</span><span class="selector-class">.2</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="3-centos7-使用nvm方式安装nodejs"><a href="#3-centos7-使用nvm方式安装nodejs" class="headerlink" title="3. centos7 使用nvm方式安装nodejs"></a>3. centos7 使用nvm方式安装nodejs</h3><ol>
<li><p>安装nvm 最新版本是0.33.11 <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">git地址</a></p>
</li>
<li><pre><code># curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
or Wget:
# wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 使配置生效</span><br></pre></td></tr></table></figure>
source ~/.bash_profile  
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 查看nvm版本</span><br></pre></td></tr></table></figure>
nvm --version  
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. 查看可安装node版本</span><br><span class="line"></span><br><span class="line">   查看可以安装的node版本，注意&#96;(Latest LTS: Carbon)&#96;标识, 此标识是长期支持的最新版本</span><br></pre></td></tr></table></figure>
nvm list-remote 
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6. 安装指定版本的node</span><br></pre></td></tr></table></figure>
nvm install v8.12.0
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">7. 确认安装结果</span><br></pre></td></tr></table></figure>
node -v  
npm -v 
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">8. 切换版本</span><br></pre></td></tr></table></figure>
nvm use v10.10.0
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">9. 设置默认版本</span><br></pre></td></tr></table></figure>
nvm alias default v10.10.0
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">10. 查看所有已安装的版本</span><br></pre></td></tr></table></figure>
nvm list
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 4. pm2使用(进程管理器)</span><br><span class="line"></span><br><span class="line">pm2 是一个带有负载均衡功能的Node应用的进程管理器.</span><br><span class="line"></span><br><span class="line">[pm2官网](https:&#x2F;&#x2F;pm2.io&#x2F;doc&#x2F;en&#x2F;runtime&#x2F;quick-start&#x2F;)</span><br><span class="line"></span><br><span class="line">以npm方式安装**pm2** (全局安装)</span><br></pre></td></tr></table></figure>
npm install pm2 -g
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">以下是pm2常用的命令行</span><br></pre></td></tr></table></figure>
$ pm2 start app.js              # 启动app.js应用程序
</code></pre></li>
</ol>
<p>$ pm2 start app.js -i 4         # cluster mode 模式启动4个app.js的应用实例     # 4个应用程序会自动进行负载均衡</p>
<p>$ pm2 start app.js –name=”api” # 启动应用程序并命名为 “api”</p>
<p>$ pm2 start app.js –watch      # 当文件变化时自动重启应用</p>
<p>$ pm2 start script.sh           # 启动 bash 脚本</p>
<p>$ pm2 list                      # 列表 PM2 启动的所有的应用程序</p>
<p>$ pm2 monit                     # 显示每个应用程序的CPU和内存占用情况</p>
<p>$ pm2 show [app-name]           # 显示应用程序的所有信息</p>
<p>$ pm2 logs                      # 显示所有应用程序的日志</p>
<p>$ pm2 logs [app-name]           # 显示指定应用程序的日志</p>
<p>$ pm2 flush</p>
<p>$ pm2 stop all                  # 停止所有的应用程序</p>
<p>$ pm2 stop 0                    # 停止 id为 0的指定应用程序</p>
<p>$ pm2 restart all               # 重启所有应用</p>
<p>$ pm2 reload all                # 重启 cluster mode下的所有应用</p>
<p>$ pm2 gracefulReload all        # Graceful reload all apps in cluster mode</p>
<p>$ pm2 delete all                # 关闭并删除所有应用</p>
<p>$ pm2 delete 0                  # 删除指定应用 id 0</p>
<p>$ pm2 scale api 10              # 把名字叫api的应用扩展到10个实例</p>
<p>$ pm2 reset [app-name]          # 重置重启数量</p>
<p>$ pm2 startup                   # 创建开机自启动命令</p>
<p>$ pm2 save                      # 保存当前应用列表</p>
<p>$ pm2 resurrect                 # 重新加载保存的应用列表</p>
<p>$ pm2 update                    # Save processes, kill PM2 and restore processes</p>
<p>$ pm2 generate                  # Generate a sample json configuration file</p>
<p>$ pm2 deploy app.json prod setup    # Setup “prod” remote server</p>
<p>$ pm2 deploy app.json prod          # Update “prod” remote server</p>
<p>$ pm2 deploy app.json prod revert 2 # Revert “prod” remote server by 2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 5. pm2开多进程时与log4j冲突, 导致log4不输出日志. (log4js pm2 cluster配置)</span><br><span class="line"></span><br><span class="line">修复方案:</span><br><span class="line"></span><br><span class="line">安装pm2-intercom</span><br></pre></td></tr></table></figure>
<p>pm2 install pm2-intercom</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">配置log4js.json的配置文件, 增加: &#96;pm2: true&#96;</span><br></pre></td></tr></table></figure>
<p> “categories”:{<br>    “default”:{“appenders”:[“console”,”log_info”],”level”:”info”},<br>    “logInfo”:{“appenders”:[“console”,”log_info”],”level”:”info”},<br>    “logErr”:{“appenders”:[“console”,”log_error”],”level”:”error”}<br>  },<br>  “pm2”: true</p>
<pre><code>


参考链接:

https://github.com/xiaozhongliu/node-api-seed/blob/master/util/logger.js

[pm2 logging problem with multiple applications](https://github.com/log4js-node/log4js-node/issues/547)

[集群模式PM2+Log4js log写入失败问题](https://juejin.im/entry/5a0cf3276fb9a0450167814f)
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/03/%E9%85%8D%E7%BD%AENode-js%E7%8E%AF%E5%A2%83/" data-id="ckc61b9ec0002p8tq8pnh8tgu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2020/07/03/Redis-2019-study/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Redis-2019-study</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/03/%E9%85%8D%E7%BD%AENode-js%E7%8E%AF%E5%A2%83/">配置Node.js环境</a>
          </li>
        
          <li>
            <a href="/2020/07/03/Redis-2019-study/">Redis-2019-study</a>
          </li>
        
          <li>
            <a href="/2020/07/03/Nginx-%E9%AB%98%E6%80%A7%E8%83%BDHTTP%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/">Nginx---高性能HTTP和反向代理服务器</a>
          </li>
        
          <li>
            <a href="/2020/07/03/nodejs-2019-study/">nodejs-2019-study</a>
          </li>
        
          <li>
            <a href="/2020/07/03/nodejs%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E8%B0%83%E6%95%B4mongodb-redis-mysql%E6%9C%80%E5%A4%A7%E8%BF%9E%E6%8E%A5%E6%95%B0/">nodejs压力测试(调整mongodb,redis,mysql最大连接数)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 assasin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>